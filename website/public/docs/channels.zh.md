# é¢‘é“é…ç½®

**é¢‘é“** = ä½ å’Œ CoPaw åœ¨ã€Œå“ªé‡Œã€å¯¹è¯ï¼šæ¥é’‰é’‰å°±åœ¨é’‰é’‰é‡Œå›ï¼Œæ¥ QQ å°±åœ¨ QQ é‡Œå›ã€‚ä¸ç†Ÿæ‚‰è¿™ä¸ªè¯çš„è¯å¯ä»¥å…ˆçœ‹ [é¡¹ç›®ä»‹ç»](./intro)ã€‚

é…ç½®é¢‘é“æœ‰ä¸¤ç§æ–¹å¼ï¼š

- **æ§åˆ¶å°**ï¼ˆæ¨èï¼‰â€” åœ¨ [æ§åˆ¶å°](./console) çš„ **Control â†’ Channels** é¡µé¢ï¼Œç‚¹å‡»é¢‘é“å¡ç‰‡ï¼Œåœ¨æŠ½å±‰é‡Œå¯ç”¨å¹¶å¡«å†™é‰´æƒä¿¡æ¯ï¼Œä¿å­˜å³ç”Ÿæ•ˆã€‚
- **æ‰‹åŠ¨ç¼–è¾‘ `config.json`** â€” é»˜è®¤åœ¨ `~/.copaw/config.json` ï¼ˆç”± `copaw init` ç”Ÿæˆï¼‰ï¼Œå°†éœ€è¦çš„é¢‘é“è®¾ `enabled: true` å¹¶å¡«å¥½é‰´æƒä¿¡æ¯ï¼›ä¿å­˜åè‡ªåŠ¨é‡è½½ï¼Œæ— éœ€é‡å¯ã€‚

æ‰€æœ‰é¢‘é“éƒ½æœ‰ä¸¤ä¸ªé€šç”¨å­—æ®µï¼š

- **enabled** â€” æ˜¯å¦å¯ç”¨
- **bot_prefix** â€” æœºå™¨äººå›å¤å‰ç¼€ï¼ˆå¦‚ `[BOT]`ï¼‰ï¼Œæ–¹ä¾¿åŒºåˆ†

ä¸‹é¢æŒ‰é¢‘é“è¯´æ˜å¦‚ä½•è·å–å‡­è¯å¹¶å¡«å†™é…ç½®ã€‚

---

## é’‰é’‰ï¼ˆæ¨èï¼‰

### åˆ›å»ºé’‰é’‰åº”ç”¨

è§†é¢‘æ“ä½œæµç¨‹ï¼š

![è§†é¢‘æ“ä½œæµç¨‹](https://cloud.video.taobao.com/vod/Fs7JecGIcHdL-np4AS7cXaLoywTDNj7BpiO7_Hb2_cA.mp4)

å›¾æ–‡æ“ä½œæµç¨‹ï¼š

1. æ‰“å¼€ [é’‰é’‰å¼€å‘è€…åå°](https://open-dev.dingtalk.com/)

2. è¿›å…¥"åº”ç”¨å¼€å‘â†’ä¼ä¸šå†…éƒ¨åº”ç”¨â†’é’‰é’‰åº”ç”¨â†’åˆ›å»º **åº”ç”¨**"

   ![é’‰é’‰å¼€å‘è€…åå°](https://img.alicdn.com/imgextra/i1/O1CN01KLtwvu1rt9weVn8in_!!6000000005688-2-tps-2809-1585.png)

3. åœ¨"åº”ç”¨èƒ½åŠ›â†’æ·»åŠ åº”ç”¨èƒ½åŠ›"ä¸­æ·»åŠ  **ã€Œæœºå™¨äººã€**

   ![æ·»åŠ æœºå™¨äºº](https://img.alicdn.com/imgextra/i2/O1CN01AboPsn1XGQ84utCG8_!!6000000002896-2-tps-2814-1581.png)

4. é…ç½®æœºå™¨äººåŸºç¡€ä¿¡æ¯ï¼Œè®¾ç½®æ¶ˆæ¯æ¥æ”¶æ¨¡å¼ä¸º **Stream æ¨¡å¼**ï¼ˆæµå¼æ¥æ”¶ï¼‰ï¼Œç‚¹å‡»å‘å¸ƒ

   ![æœºå™¨äººåŸºç¡€ä¿¡æ¯](https://img.alicdn.com/imgextra/i3/O1CN01KwmNZ61GwhDhKxgSv_!!6000000000687-2-tps-2814-1581.png)

   ![Streamæ¨¡å¼+å‘å¸ƒ](https://img.alicdn.com/imgextra/i2/O1CN01tk8QW11NqvXYqcoPH_!!6000000001622-2-tps-2809-1590.png)

5. åœ¨"åº”ç”¨å‘å¸ƒâ†’ç‰ˆæœ¬ç®¡ç†ä¸å‘å¸ƒ"ä¸­åˆ›å»ºæ–°ç‰ˆæœ¬ï¼Œå¡«å†™åŸºç¡€ä¿¡æ¯åä¿å­˜

   ![åˆ›å»ºæ–°ç‰ˆæœ¬](https://img.alicdn.com/imgextra/i3/O1CN01lRCPuf1PQwIeFL4AL_!!6000000001836-2-tps-2818-1590.png)

   ![ä¿å­˜](https://img.alicdn.com/imgextra/i1/O1CN01vrzbIA1Qey2x8Jbua_!!6000000002002-2-tps-2809-1585.png)

6. åœ¨"åŸºç¡€ä¿¡æ¯â†’å‡­è¯ä¸åŸºç¡€ä¿¡æ¯"ä¸­è·å–ï¼š

   - **Client ID**ï¼ˆå³ AppKeyï¼‰
   - **Client Secret**ï¼ˆå³ AppSecretï¼‰

   ![client](https://img.alicdn.com/imgextra/i3/O1CN01JsRrwx1hJImLfM7O1_!!6000000004256-2-tps-2809-1585.png)

7. **å°†æœåŠ¡å™¨ IP åŠ å…¥ç™½åå•** â€” è°ƒç”¨é’‰é’‰å¼€æ”¾å¹³å° APIï¼ˆå¦‚ä¸‹è½½ç”¨æˆ·å‘é€çš„å›¾ç‰‡å’Œæ–‡ä»¶ï¼‰æ—¶éœ€è¦æ­¤é…ç½®ã€‚åœ¨åº”ç”¨è®¾ç½®ä¸­è¿›å…¥ **"å®‰å…¨è®¾ç½®â†’æœåŠ¡å™¨å‡ºå£ IP"**ï¼Œæ·»åŠ è¿è¡Œ CoPaw çš„æœºå™¨çš„å…¬ç½‘ IPã€‚å¯åœ¨ç»ˆç«¯æ‰§è¡Œ `curl ifconfig.me` æŸ¥çœ‹å…¬ç½‘ IPã€‚è‹¥æœªé…ç½®ç™½åå•ï¼Œå›¾ç‰‡å’Œæ–‡ä»¶ä¸‹è½½å°†æŠ¥ `Forbidden.AccessDenied.IpNotInWhiteList` é”™è¯¯ã€‚

### ç»‘å®šåº”ç”¨

å¯ä»¥åœ¨consoleå‰ç«¯é…ç½®ï¼Œæˆ–è€…ä¿®æ”¹`~/.copaw/config.json`ã€‚

**æ–¹æ³•1**: åœ¨consoleå‰ç«¯é…ç½®

ä»â€œæ§åˆ¶â†’é¢‘é“â€æ‰¾åˆ°**DingTalk**ï¼Œç‚¹å‡»åå¡«å…¥åˆšåˆšè·å–çš„**Client ID**å’Œ**Client Secret**

![console](https://img.alicdn.com/imgextra/i1/O1CN01uXrlyQ25Zpr5eVksk_!!6000000007541-2-tps-3451-1778.png)

**æ–¹æ³•2**: ä¿®æ”¹`~/.copaw/config.json`

åœ¨ `config.json` é‡Œæ‰¾åˆ° `channels.dingtalk`ï¼Œå¡«å…¥å¯¹åº”ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š

```json
"dingtalk": {
  "enabled": true,
  "bot_prefix": "[BOT]",
  "client_id": "ä½ çš„ Client ID",
  "client_secret": "ä½ çš„ Client Secret"
}
```

ä¿å­˜åè‹¥æœåŠ¡å·²è¿è¡Œä¼šè‡ªåŠ¨é‡è½½ï¼›æœªè¿è¡Œåˆ™æ‰§è¡Œ `copaw app` å¯åŠ¨ã€‚

### æ‰¾åˆ°åˆ›å»ºçš„åº”ç”¨

è§†é¢‘æ“ä½œæµç¨‹ï¼š

![è§†é¢‘æ“ä½œæµç¨‹](https://cloud.video.taobao.com/vod/e0icQREdiZ1LI0b1mWdBDQI94KdJSaJxO09X5BPaWvk.mp4)

å›¾æ–‡æ“ä½œæµç¨‹ï¼š

1. ç‚¹å‡»é’‰é’‰ã€æ¶ˆæ¯ã€‘æ çš„â€œæœç´¢æ¡†â€

![æœºå™¨äººåç§°](https://img.alicdn.com/imgextra/i4/O1CN019tRcAi1IIy630Kttu_!!6000000000871-2-tps-2809-2241.png)

2. æœç´¢åˆšåˆšåˆ›å»ºçš„ â€œæœºå™¨äººåç§°â€ï¼Œåœ¨ã€åŠŸèƒ½ã€‘ä¸‹æ‰¾åˆ°æœºå™¨äºº

![æœºå™¨äºº](https://img.alicdn.com/imgextra/i3/O1CN01Ha69lm23sx9kLX8eD_!!6000000007312-2-tps-2809-2236.png)

3. ç‚¹å‡»åè¿›å…¥å¯¹è¯æ¡†

![å¯¹è¯æ¡†](https://img.alicdn.com/imgextra/i1/O1CN01zjnc7J23hxeOJGYiO_!!6000000007288-2-tps-2046-1630.png)

> æ³¨ï¼šå¯ä»¥åœ¨é’‰é’‰ç¾¤ä¸­é€šè¿‡**ç¾¤è®¾ç½®â†’æœºå™¨äººâ†’æ·»åŠ æœºå™¨äºº**å°†æœºå™¨äººæ·»åŠ åˆ°ç¾¤èŠã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»ä¸æœºå™¨äººçš„å•èŠç•Œé¢ä¸­åˆ›å»ºç¾¤èŠï¼Œä¼šæ— æ³•è§¦å‘æœºå™¨äººçš„å›å¤ã€‚

---

## é£ä¹¦

é£ä¹¦é¢‘é“é€šè¿‡ **WebSocket é•¿è¿æ¥** æ¥æ”¶æ¶ˆæ¯ï¼Œæ— éœ€å…¬ç½‘ IP æˆ– webhookï¼›å‘é€èµ°é£ä¹¦å¼€æ”¾å¹³å° Open APIã€‚æ”¯æŒæ–‡æœ¬ã€å›¾ç‰‡ã€æ–‡ä»¶æ”¶å‘ï¼›ç¾¤èŠåœºæ™¯ä¸‹ä¼šå°† `chat_id`ã€`message_id` æ”¾å…¥è¯·æ±‚æ¶ˆæ¯çš„ metadataï¼Œä¾¿äºä¸‹æ¸¸å»é‡ä¸ç¾¤ä¸Šä¸‹æ–‡è¯†åˆ«ã€‚

### åˆ›å»ºé£ä¹¦åº”ç”¨å¹¶è·å–å‡­è¯

1. æ‰“å¼€ [é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn/app)ï¼Œåˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨

![é£ä¹¦](https://img.alicdn.com/imgextra/i1/O1CN01awX3Nc1WjRc43kDSk_!!6000000002824-2-tps-4082-2126.png)

![build](https://img.alicdn.com/imgextra/i3/O1CN01OXSFsM1EDh4Xa2aOz_!!6000000000318-2-tps-4082-2126.png)

2. åœ¨ã€Œå‡­è¯ä¸åŸºç¡€ä¿¡æ¯ã€ä¸­è·å– **App ID**ã€**App Secret**

![id & secret](https://img.alicdn.com/imgextra/i2/O1CN01tWGGEE1PAuR7APQcs_!!6000000001801-2-tps-4082-2126.png)

3. åœ¨ `config.json` ä¸­å¡«å†™ä¸Šè¿° **App ID** å’Œ **App Secret**ï¼ˆè§ä¸‹æ–¹ã€Œå¡«å†™ config.jsonã€ï¼‰ï¼Œä¿å­˜

4. æ‰§è¡Œ **`copaw app`** å¯åŠ¨ CoPAW æœåŠ¡

5. å›åˆ°é£ä¹¦å¼€æ”¾å¹³å°ï¼Œåœ¨ã€Œèƒ½åŠ›ã€ä¸­å¯ç”¨ **æœºå™¨äºº**

![bot](https://img.alicdn.com/imgextra/i1/O1CN01eFPe0d1wU2IY4Fyvt_!!6000000006310-2-tps-4082-2126.png)

6. é€‰æ‹©ã€Œæƒé™ç®¡ç†ã€ä¸­çš„ã€Œæ‰¹é‡å¯¼å…¥/å¯¼å‡ºæƒé™ã€ï¼Œå°†ä»¥ä¸‹JSONä»£ç å¤åˆ¶è¿›å»

```json
{
  "scopes": {
    "tenant": [
      "aily:file:read",
      "aily:file:write",
      "aily:message:read",
      "aily:message:write",
      "corehr:file:download",
      "im:chat",
      "im:message",
      "im:message.group_msg",
      "im:message.p2p_msg:readonly",
      "im:message.reactions:read",
      "im:resource",
      "contact:user.base:readonly"
    ],
    "user": []
  }
}
```

![in/out](https://img.alicdn.com/imgextra/i4/O1CN01CpUMJn1ey7E6FIpOU_!!6000000003939-2-tps-4082-2126.png)

![json](https://img.alicdn.com/imgextra/i3/O1CN01idxezh1G04WY9SYZR_!!6000000000559-2-tps-4082-2126.png)

![confirm](https://img.alicdn.com/imgextra/i3/O1CN017nCNTC1Lj1TVH1OIt_!!6000000001334-2-tps-4082-2126.png)

![confirm](https://img.alicdn.com/imgextra/i3/O1CN01hwOxur1EV67a7clee_!!6000000000356-2-tps-4082-2126.png)

7. åœ¨ã€Œäº‹ä»¶ä¸å›è°ƒã€ä¸­ï¼Œç‚¹å‡»ã€Œäº‹ä»¶é…ç½®ã€ï¼Œé€‰æ‹©è®¢é˜…æ–¹å¼ä¸º**é•¿è¿æ¥ï¼ˆWebSocketï¼‰** æ¨¡å¼ï¼ˆæ— éœ€å…¬ç½‘ IPï¼‰

> æ³¨ï¼š**æ“ä½œé¡ºåº**ä¸ºå…ˆé…ç½® App ID/Secret â†’ å¯åŠ¨ `copaw app` â†’ å†åœ¨å¼€æ”¾å¹³å°é…ç½®é•¿è¿æ¥ï¼Œå¦‚æœæ­¤å¤„ä»æ˜¾ç¤ºé”™è¯¯ï¼Œå°è¯•å…ˆæš‚åœcopawæœåŠ¡å¹¶é‡æ–°å¯åŠ¨ `copaw app`ã€‚

![websocket](https://img.alicdn.com/imgextra/i2/O1CN01LQwKON1x7QMNP41kC_!!6000000006396-2-tps-4082-2126.png)

8. é€‰æ‹©ã€Œæ·»åŠ äº‹ä»¶ã€ï¼Œæœç´¢**æ¥æ”¶æ¶ˆæ¯**ï¼Œè®¢é˜…**æ¥æ”¶æ¶ˆæ¯ v2.0**

![reveive](https://img.alicdn.com/imgextra/i3/O1CN01svBdl41HTDLCtKFed_!!6000000000758-2-tps-4082-2126.png)

![click](https://img.alicdn.com/imgextra/i4/O1CN01Rat93U1sLYV9f5dhe_!!6000000005750-2-tps-4082-2126.png)

![result](https://img.alicdn.com/imgextra/i2/O1CN015GPfGr1BsxuoOXbYC_!!6000000000002-2-tps-4082-2126.png)

9. åœ¨ã€Œåº”ç”¨å‘å¸ƒã€çš„ã€Œç‰ˆæœ¬ç®¡ç†ä¸å‘å¸ƒã€ä¸­ï¼Œ**åˆ›å»ºç‰ˆæœ¬**ï¼Œå¡«å†™åŸºç¡€ä¿¡æ¯ï¼Œ**ä¿å­˜**å¹¶**å‘å¸ƒ**

![create](https://img.alicdn.com/imgextra/i1/O1CN01zOqMGk1lhoREn9Lip_!!6000000004851-2-tps-4082-2126.png)

![info](https://img.alicdn.com/imgextra/i1/O1CN01SQg28h1nAUrLKTH1J_!!6000000005049-2-tps-4082-2126.png)

![save](https://img.alicdn.com/imgextra/i1/O1CN01ebVPlq1lzDUM1Mwej_!!6000000004889-2-tps-4082-2126.png)

### å¡«å†™ config.json

åœ¨`config.json`ï¼ˆé»˜è®¤åœ¨ `~/.copaw/config.json`ï¼‰ä¸­æ‰¾åˆ°`channels.feishu`ï¼Œåªéœ€å¡« **App ID** å’Œ **App Secret**ï¼ˆåœ¨å¼€æ”¾å¹³å°ã€Œå‡­è¯ä¸åŸºç¡€ä¿¡æ¯ã€é‡Œå¤åˆ¶ï¼‰ï¼š

```json
"feishu": {
  "enabled": true,
  "bot_prefix": "[BOT]",
  "app_id": "cli_xxxxx",
  "app_secret": "ä½ çš„ App Secret"
}
```

å…¶ä»–å­—æ®µï¼ˆencrypt_keyã€verification_tokenã€media_dirï¼‰å¯é€‰ï¼ŒWebSocket æ¨¡å¼å¯ä¸å¡«ï¼Œæœ‰é»˜è®¤å€¼ã€‚ä¾èµ–ï¼š`pip install lark-oapi`ï¼Œç„¶å `copaw app`ã€‚

> æ³¨: **App ID** å’Œ **App Secret** ä¿¡æ¯ä¹Ÿå¯ä»¥åœ¨Consoleå‰ç«¯å¡«å†™ï¼Œä½†éœ€é‡å¯copawæœåŠ¡ï¼Œæ‰èƒ½ç»§ç»­é…ç½®é•¿é“¾æ¥çš„æ“ä½œã€‚
> ![console](https://img.alicdn.com/imgextra/i2/O1CN01k7UVrP1E2hZBAn0oF_!!6000000000294-2-tps-4082-2126.png)

### æœºå™¨äººæƒé™å»ºè®®

ç¬¬6æ­¥ä¸­çš„jsonæ–‡ä»¶ä¸ºåº”ç”¨é…å¤‡äº†ä»¥ä¸‹æƒé™ï¼ˆåº”ç”¨èº«ä»½ã€å·²å¼€é€šï¼‰ï¼Œä»¥ä¿è¯æ”¶å‘æ¶ˆæ¯ä¸æ–‡ä»¶æ­£å¸¸ï¼š

| æƒé™åç§°                       | æƒé™æ ‡è¯†                       | æƒé™ç±»å‹     | è¯´æ˜           |
| ------------------------------ | ------------------------------ | ------------ | -------------- |
| è·å–æ–‡ä»¶                       | aily:file:read                 | åº”ç”¨èº«ä»½     | -              |
| ä¸Šä¼ æ–‡ä»¶                       | aily:file:write                | åº”ç”¨èº«ä»½     | -              |
| è·å–æ¶ˆæ¯                       | aily:message:read              | åº”ç”¨èº«ä»½     | -              |
| å‘é€æ¶ˆæ¯                       | aily:message:write             | åº”ç”¨èº«ä»½     | -              |
| ä¸‹è½½æ–‡ä»¶                       | corehr:file:download           | åº”ç”¨èº«ä»½     | -              |
| è·å–ä¸æ›´æ–°ç¾¤ç»„ä¿¡æ¯             | im:chat                        | åº”ç”¨èº«ä»½     | -              |
| è·å–ä¸å‘é€å•èŠã€ç¾¤ç»„æ¶ˆæ¯       | im:message                     | åº”ç”¨èº«ä»½     | -              |
| è·å–ç¾¤ç»„ä¸­æ‰€æœ‰æ¶ˆæ¯ï¼ˆæ•æ„Ÿæƒé™ï¼‰ | im:message.group_msg           | åº”ç”¨èº«ä»½     | -              |
| è¯»å–ç”¨æˆ·å‘ç»™æœºå™¨äººçš„å•èŠæ¶ˆæ¯   | im:message.p2p_msg:readonly    | åº”ç”¨èº«ä»½     | -              |
| æŸ¥çœ‹æ¶ˆæ¯è¡¨æƒ…å›å¤               | im:message.reactions:read      | åº”ç”¨èº«ä»½     | -              |
| è·å–ä¸ä¸Šä¼ å›¾ç‰‡æˆ–æ–‡ä»¶èµ„æº       | im:resource                    | åº”ç”¨èº«ä»½     | -              |
| **ä»¥åº”ç”¨èº«ä»½è¯»å–é€šè®¯å½•**       | **contact:user.base:readonly** | **åº”ç”¨èº«ä»½** | **è§ä¸‹æ–¹è¯´æ˜** |

> **è·å–ç”¨æˆ·æ˜µç§°ï¼ˆæ¨èï¼‰**ï¼šè‹¥å¸Œæœ›ä¼šè¯å’Œæ—¥å¿—ä¸­æ˜¾ç¤º**ç”¨æˆ·æ˜µç§°**ï¼ˆå¦‚ã€Œå¼ ä¸‰#1d1aã€ï¼‰è€Œéã€Œunknown#1d1aã€ï¼Œéœ€é¢å¤–å¼€é€šé€šè®¯å½•åªè¯»æƒé™ **ä»¥åº”ç”¨èº«ä»½è¯»å–é€šè®¯å½•**ï¼ˆ`contact:user.base:readonly`ï¼‰ã€‚æœªå¼€é€šæ—¶ï¼Œé£ä¹¦ä»…è¿”å› open_id ç­‰èº«ä»½å­—æ®µï¼Œä¸è¿”å›å§“åï¼ŒCoPAW æ— æ³•è§£ææ˜µç§°ã€‚å¼€é€šåéœ€é‡æ–°å‘å¸ƒ/æ›´æ–°åº”ç”¨ç‰ˆæœ¬ï¼Œæƒé™ç”Ÿæ•ˆåå³å¯æ­£å¸¸æ˜¾ç¤ºç”¨æˆ·åç§°ã€‚

### å°†æœºå™¨äººæ·»åŠ åˆ°å¸¸ç”¨

1. åœ¨**å·¥ä½œå°**ç‚¹å‡»**æ·»åŠ å¸¸ç”¨**

![æ·»åŠ å¸¸ç”¨](https://img.alicdn.com/imgextra/i2/O1CN01bSKw0t1tCgReoZNRr_!!6000000005866-2-tps-2614-1488.png)

2. æœç´¢åˆšåˆšåˆ›å»ºçš„æœºå™¨äººåç§°å¹¶**æ·»åŠ **

![æ·»åŠ ](https://img.alicdn.com/imgextra/i1/O1CN01aNNTI51IZSM4TYqis_!!6000000000907-2-tps-3785-2158.png)

3. å¯ä»¥çœ‹åˆ°æœºå™¨äººå·²æ·»åŠ åˆ°å¸¸ç”¨ä¸­ï¼ŒåŒå‡»å¯è¿›å…¥å¯¹è¯ç•Œé¢

![å·²æ·»åŠ ](https://img.alicdn.com/imgextra/i1/O1CN01Kulh7i1Hfa2Dnfpa4_!!6000000000785-2-tps-2614-1488.png)

![å¯¹è¯ç•Œé¢](https://img.alicdn.com/imgextra/i4/O1CN01vsnwn71UMQTaEa0XX_!!6000000002503-2-tps-2614-1488.png)

---

## iMessageï¼ˆä»… macOSï¼‰

> âš ï¸ iMessage é¢‘é“ä»…æ”¯æŒ **macOS**ï¼Œä¾èµ–æœ¬åœ°ã€Œä¿¡æ¯ã€åº”ç”¨ä¸ iMessage æ•°æ®åº“ï¼Œæ— æ³•åœ¨ Linux / Windows ä¸Šä½¿ç”¨ã€‚

é€šè¿‡æœ¬åœ° iMessage æ•°æ®åº“è½®è¯¢æ–°æ¶ˆæ¯å¹¶ä»£ä¸ºå›å¤ã€‚

### å‰ç½®å‡†å¤‡

- ç¡®ä¿æœ¬åœ° **ã€Œä¿¡æ¯ã€(Messages)** å·²ç™»å½• Apple IDï¼ˆç³»ç»Ÿè®¾ç½®é‡Œæ‰“å¼€ã€Œä¿¡æ¯ã€å¹¶ç™»å½•ï¼‰ã€‚
- å®‰è£… **imsg**ï¼ˆç”¨äºè®¿é—® iMessage æ•°æ®åº“ï¼‰ï¼š
  ```bash
  brew install steipete/tap/imsg
  ```
- ç³»ç»Ÿ iMessage æ•°æ®åº“é»˜è®¤è·¯å¾„ä¸º `~/Library/Messages/chat.db`ï¼Œè‹¥ä½ æ”¹è¿‡ç³»ç»Ÿè·¯å¾„ï¼Œè¯·å¡«å®é™…è·¯å¾„ã€‚
- åº”ç”¨éœ€è¦ **å®Œå…¨ç£ç›˜è®¿é—®æƒé™**ï¼ˆç³»ç»Ÿè®¾ç½® â†’ éšç§ä¸å®‰å…¨æ€§ â†’ å®Œå…¨ç£ç›˜è®¿é—®æƒé™ï¼‰ï¼Œå¦åˆ™æ— æ³•è¯»å– `chat.db`ã€‚
- ä»…é™æœ¬åœ°ä½¿ç”¨ï¼Œæ•°æ®ä¸ç¦»å¼€ä½ çš„ç”µè„‘ã€‚

### å¡«å†™ config.json

```json
"imessage": {
  "enabled": true,
  "bot_prefix": "[BOT]",
  "db_path": "~/Library/Messages/chat.db",
  "poll_sec": 1.0
}
```

- **db_path** â€” iMessage æ•°æ®åº“è·¯å¾„
- **poll_sec** â€” è½®è¯¢é—´éš”ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ 1 å³å¯

---

## Discord

### è·å– Bot Token

1. æ‰“å¼€ [Discord å¼€å‘è€…é—¨æˆ·](https://discord.com/developers/applications)

![Discordå¼€å‘è€…é—¨æˆ·](https://img.alicdn.com/imgextra/i2/O1CN01oV68yZ1sb7y3nGoQN_!!6000000005784-2-tps-4066-2118.png)

2. æ–°å»ºåº”ç”¨ï¼ˆæˆ–é€‰å·²æœ‰åº”ç”¨ï¼‰

![æ–°å»ºåº”ç”¨](https://img.alicdn.com/imgextra/i2/O1CN01eA9lA71kMukVCWR4y_!!6000000004670-2-tps-3726-1943.png)

3. å·¦ä¾§è¿›å…¥ **Bot**ï¼Œæ–°å»º Botï¼Œå¤åˆ¶ **Token**

![token](https://img.alicdn.com/imgextra/i1/O1CN01iuPiUe1lJzqEiIu23_!!6000000004799-2-tps-2814-1462.png)

4. ä¸‹æ»‘ï¼Œç»™äºˆ Bot â€œMessage Content Intentâ€ å’Œ â€œSend Messagesâ€ çš„æƒé™ï¼Œå¹¶ä¿å­˜

![æƒé™](https://img.alicdn.com/imgextra/i4/O1CN01EXH4w51FSdbxYKLG9_!!6000000000486-2-tps-4066-2118.png)

5. åœ¨ **OAuth2 â†’ URL ç”Ÿæˆå™¨** é‡Œå‹¾é€‰ `bot` æƒé™ï¼Œç»™äºˆ Bot â€œSend Messagesâ€ çš„æƒé™ï¼Œç”Ÿæˆé‚€è¯·é“¾æ¥

![bot](https://img.alicdn.com/imgextra/i2/O1CN01B2oXx71KVS7kjKSEm_!!6000000001169-2-tps-4066-2118.png)

![send messages](https://img.alicdn.com/imgextra/i3/O1CN01DlU9oi1QYYVBPoUIA_!!6000000001988-2-tps-4066-2118.png)

![link](https://img.alicdn.com/imgextra/i2/O1CN01ljhh1j1OZLxb2mAkO_!!6000000001719-2-tps-4066-2118.png)

6. åœ¨æµè§ˆå™¨ä¸­è®¿é—®è¯¥é“¾æ¥ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°discordé¡µé¢ã€‚å°† Bot æ‹‰è¿›ä½ çš„æœåŠ¡å™¨

![æœåŠ¡å™¨](https://img.alicdn.com/imgextra/i1/O1CN01ivgmOA1JuM2i9WNqm_!!6000000001088-2-tps-2806-1824.png)

![æœåŠ¡å™¨](https://img.alicdn.com/imgextra/i2/O1CN01ecRCVa1UeHvFUP0XQ_!!6000000002542-2-tps-2806-1824.png)

7. åœ¨æœåŠ¡å™¨ä¸­å¯ä»¥çœ‹åˆ° Botå·²è¢«æ‹‰å…¥

![åšå¤©](https://img.alicdn.com/imgextra/i2/O1CN014HOCCJ1fsuL2RQiB5_!!6000000004063-2-tps-2806-1824.png)

### ç»‘å®š Bot

å¯ä»¥åœ¨consoleå‰ç«¯é…ç½®ï¼Œæˆ–è€…ä¿®æ”¹`~/.copaw/config.json`ã€‚

**æ–¹æ³•1**: åœ¨consoleå‰ç«¯é…ç½®

ä»â€œæ§åˆ¶â†’é¢‘é“â€æ‰¾åˆ°**Discord**ï¼Œç‚¹å‡»åå¡«å…¥åˆšåˆšè·å–çš„**Bot Token**

![console](https://img.alicdn.com/imgextra/i2/O1CN01kP657n1XK5IXfPLAv_!!6000000002904-2-tps-4082-2126.png)

**æ–¹æ³•2**: ä¿®æ”¹`~/.copaw/config.json`

åœ¨ `config.json` é‡Œæ‰¾åˆ° `channels.discord`ï¼Œå¡«å…¥å¯¹åº”ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š

```json
"discord": {
  "enabled": true,
  "bot_prefix": "[BOT]",
  "bot_token": "ä½ çš„ Bot Token",
  "http_proxy": "",
  "http_proxy_auth": ""
}
```

å›½å†…ç½‘ç»œè®¿é—® Discord API å¯èƒ½éœ€ä»£ç†ã€‚å¦‚éœ€ä»£ç†ï¼š

- **http_proxy** â€” ä¾‹å¦‚ `http://127.0.0.1:7890`
- **http_proxy_auth** â€” è‹¥ä»£ç†éœ€é‰´æƒï¼Œå¡« `ç”¨æˆ·å:å¯†ç `ï¼Œå¦åˆ™ç•™ç©º

---

## QQ

### è·å– QQ æœºå™¨äººå‡­è¯

1. æ‰“å¼€ [QQ å¼€æ”¾å¹³å°](https://q.qq.com/)

![å¼€æ”¾å¹³å°](https://img.alicdn.com/imgextra/i4/O1CN01OjCvUf1oT6ZDWpEk5_!!6000000005225-2-tps-4082-2126.png)

2. åˆ›å»º **æœºå™¨äººåº”ç”¨**ï¼Œç‚¹å‡»è¿›å…¥ç¼–è¾‘é¡µé¢

![bot](https://img.alicdn.com/imgextra/i3/O1CN01xBbXWa1pSTdioYFdg_!!6000000005359-2-tps-4082-2126.png)

![confirm](https://img.alicdn.com/imgextra/i3/O1CN01zt7w0V1Ij4fjcm5MS_!!6000000000928-2-tps-4082-2126.png)

3. é€‰æ‹©**å›è°ƒé…ç½®**ï¼Œé¦–å…ˆåœ¨**å•èŠäº‹ä»¶**ä¸­å‹¾é€‰**C2Cæ¶ˆæ¯äº‹ä»¶**ï¼Œå†åœ¨**ç¾¤äº‹ä»¶**ä¸­å‹¾é€‰**ç¾¤æ¶ˆæ¯äº‹ä»¶ATäº‹ä»¶**ï¼Œç¡®è®¤é…ç½®

![c2c](https://img.alicdn.com/imgextra/i4/O1CN01HDSoX91iOAbTVULZf_!!6000000004402-2-tps-4082-2126.png)

![at](https://img.alicdn.com/imgextra/i4/O1CN01UJn1AK1UKatKkjMv4_!!6000000002499-2-tps-4082-2126.png)

4. é€‰æ‹©**æ²™ç®±é…ç½®**ä¸­çš„**æ¶ˆæ¯åˆ—è¡¨é…ç½®é¡¹**ï¼Œç‚¹å‡»**æ·»åŠ æˆå‘˜**ï¼Œé€‰æ‹©æ·»åŠ **è‡ªå·±**

![1](https://img.alicdn.com/imgextra/i4/O1CN01BSdkXl1ckG0dC7vH9_!!6000000003638-2-tps-4082-2126.png)

![1](https://img.alicdn.com/imgextra/i4/O1CN01LGYUMe1la1hmtcuyY_!!6000000004834-2-tps-4082-2126.png)

5. åœ¨**å¼€å‘ç®¡ç†**ä¸­è·å–**AppID**å’Œ**AppSecret**ï¼ˆå³ ClientSecretï¼‰ï¼Œå¡«å…¥configï¼Œæ–¹å¼è§ä¸‹æ–¹å¡«å†™config.jsonã€‚åœ¨\***\*IPç™½åå•**ä¸­æ·»åŠ ä¸€ä¸ªIPã€‚

![1](https://img.alicdn.com/imgextra/i4/O1CN012UQWI21cnvBAUcz54_!!6000000003646-2-tps-4082-2126.png)

6. åœ¨æ²™ç®±é…ç½®ä¸­ï¼Œä½¿ç”¨QQæ‰«ç ï¼Œå°†æœºå™¨äººæ·»åŠ åˆ°æ¶ˆæ¯åˆ—è¡¨

![1](https://img.alicdn.com/imgextra/i3/O1CN01r1OvPy1kcwc30w32K_!!6000000004705-2-tps-4082-2126.png)

### å¡«å†™ config.json

åœ¨ `config.json` é‡Œæ‰¾åˆ° `channels.qq`ï¼ŒæŠŠä¸Šé¢ä¸¤ä¸ªå€¼åˆ†åˆ«å¡«è¿› `app_id` å’Œ `client_secret`ï¼š

```json
"qq": {
  "enabled": true,
  "bot_prefix": "[BOT]",
  "app_id": "ä½ çš„ AppID",
  "client_secret": "ä½ çš„ AppSecret"
}
```

æ³¨æ„ï¼šè¿™é‡Œå¡«çš„æ˜¯ **AppID** å’Œ **AppSecret** ä¸¤ä¸ªå­—æ®µï¼Œä¸æ˜¯æ‹¼æˆä¸€æ¡ Tokenã€‚

æˆ–è€…ä¹Ÿå¯ä»¥åœ¨consoleå‰ç«¯å¡«å†™

![1](https://img.alicdn.com/imgextra/i1/O1CN01kK9tSJ1MHpZmGR2o9_!!6000000001410-2-tps-4082-2126.png)

---

## é™„å½•

### é…ç½®æ€»è§ˆ

| é¢‘é“     | é…ç½®é”®   | å¿…å¡«/ä¸»è¦å­—æ®µ                                                       |
| -------- | -------- | ------------------------------------------------------------------- |
| é’‰é’‰     | dingtalk | client_id, client_secret                                            |
| é£ä¹¦     | feishu   | app_id, app_secretï¼›å¯é€‰ encrypt_key, verification_token, media_dir |
| iMessage | imessage | db_path, poll_secï¼ˆä»… macOSï¼‰                                       |
| Discord  | discord  | bot_tokenï¼›å¯é€‰ http_proxy, http_proxy_auth                         |
| QQ       | qq       | app_id, client_secret                                               |

å„é¢‘é“å­—æ®µä¸å®Œæ•´ç»“æ„è§ä¸Šæ–‡è¡¨æ ¼åŠ [é…ç½®ä¸å·¥ä½œç›®å½•](./config)ã€‚

### å¤šæ¨¡æ€æ¶ˆæ¯æ”¯æŒ

ä¸åŒé¢‘é“å¯¹ã€Œæ–‡æœ¬ / å›¾ç‰‡ / è§†é¢‘ / éŸ³é¢‘ / æ–‡ä»¶ã€çš„**æ¥æ”¶**ï¼ˆç”¨æˆ·å‘ç»™æœºå™¨äººï¼‰ä¸**å‘é€**ï¼ˆæœºå™¨äººå›å¤ç”¨æˆ·ï¼‰æ”¯æŒç¨‹åº¦å¦‚ä¸‹ã€‚
ã€Œâœ“ã€= å·²æ”¯æŒï¼›ã€ŒğŸš§ã€= æ–½å·¥ä¸­ï¼ˆå¯å®ç°ä½†å°šæœªå®ç°ï¼‰ï¼›ã€Œâœ—ã€= ä¸æ”¯æŒï¼ˆè¯¥é¢‘é“æœ¬èº«æ— æ³•æ”¯æŒï¼‰ã€‚

| é¢‘é“     | æ¥æ”¶æ–‡æœ¬ | æ¥æ”¶å›¾ç‰‡ | æ¥æ”¶è§†é¢‘ | æ¥æ”¶éŸ³é¢‘ | æ¥æ”¶æ–‡ä»¶ | å‘é€æ–‡æœ¬ | å‘é€å›¾ç‰‡ | å‘é€è§†é¢‘ | å‘é€éŸ³é¢‘ | å‘é€æ–‡ä»¶ |
| -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- |
| é’‰é’‰     | âœ“        | âœ“        | âœ“        | âœ“        | âœ“        | âœ“        | âœ“        | âœ“        | âœ“        | âœ“        |
| é£ä¹¦     | âœ“        | âœ“        | âœ“        | âœ“        | âœ“        | âœ“        | âœ“        | âœ“        | âœ“        | âœ“        |
| Discord  | âœ“        | âœ“        | âœ“        | âœ“        | âœ“        | âœ“        | ğŸš§       | ğŸš§       | ğŸš§       | ğŸš§       |
| iMessage | âœ“        | âœ—        | âœ—        | âœ—        | âœ—        | âœ“        | âœ—        | âœ—        | âœ—        | âœ—        |
| QQ       | âœ“        | ğŸš§       | ğŸš§       | ğŸš§       | ğŸš§       | âœ“        | ğŸš§       | ğŸš§       | ğŸš§       | ğŸš§       |

è¯´æ˜ï¼š

- **é’‰é’‰**ï¼šæ¥æ”¶æ”¯æŒå¯Œæ–‡æœ¬ä¸å•æ–‡ä»¶ï¼ˆdownloadCodeï¼‰ï¼Œå‘é€é€šè¿‡ä¼šè¯ webhook æ”¯æŒå›¾ç‰‡ / è¯­éŸ³ / è§†é¢‘ / æ–‡ä»¶ã€‚
- **é£ä¹¦**ï¼šWebSocket é•¿è¿æ¥æ”¶æ¶ˆæ¯ï¼ŒOpen API å‘é€ï¼›æ”¯æŒæ–‡æœ¬ / å›¾ç‰‡ / æ–‡ä»¶æ”¶å‘ï¼›ç¾¤èŠæ—¶åœ¨æ¶ˆæ¯ metadata ä¸­å¸¦ `feishu_chat_id`ã€`feishu_message_id` ä¾¿äºä¸‹æ¸¸å»é‡ä¸ç¾¤ä¸Šä¸‹æ–‡ã€‚
- **Discord**ï¼šæ¥æ”¶æ—¶é™„ä»¶ä¼šè§£æä¸ºå›¾ç‰‡ / è§†é¢‘ / éŸ³é¢‘ / æ–‡ä»¶å¹¶ä¼ å…¥ Agentï¼›å›å¤æ—¶çœŸå®é™„ä»¶å‘é€ä¸º ğŸš§ æ–½å·¥ä¸­ï¼Œå½“å‰ä»…ä»¥é“¾æ¥å½¢å¼é™„åœ¨æ–‡æœ¬ä¸­ã€‚
- **iMessage**ï¼šåŸºäºæœ¬åœ° imsg + æ•°æ®åº“è½®è¯¢ï¼Œä»…æ”¯æŒæ–‡æœ¬æ”¶å‘ï¼›å¹³å°/å®ç°é™åˆ¶ï¼Œæ— æ³•æ”¯æŒé™„ä»¶ï¼ˆâœ—ï¼‰ã€‚
- **QQ**ï¼šæ¥æ”¶ä¾§é™„ä»¶è§£æä¸ºå¤šæ¨¡æ€ã€å‘é€ä¾§çœŸå®åª’ä½“å‡ä¸º ğŸš§ æ–½å·¥ä¸­ï¼Œå½“å‰ä»…æ–‡æœ¬ + é“¾æ¥å½¢å¼ã€‚

### é€šè¿‡ HTTP ä¿®æ”¹é…ç½®

æœåŠ¡è¿è¡Œæ—¶å¯è¯»å†™é¢‘é“é…ç½®ï¼Œä¿®æ”¹ä¼šå†™å› `config.json` å¹¶è‡ªåŠ¨ç”Ÿæ•ˆï¼š

- `GET /config/channels` â€” è·å–å…¨éƒ¨é¢‘é“
- `PUT /config/channels` â€” æ•´ä½“è¦†ç›–
- `GET /config/channels/{channel_name}` â€” è·å–å•ä¸ªï¼ˆå¦‚ `dingtalk`ã€`imessage`ï¼‰
- `PUT /config/channels/{channel_name}` â€” æ›´æ–°å•ä¸ª

---

## æ‰©å±•æ¸ é“

å¦‚éœ€æ¥å…¥æ–°å¹³å°ï¼ˆå¦‚ä¼ä¸šå¾®ä¿¡ã€Slack ç­‰ï¼‰ï¼Œå¯åŸºäº **BaseChannel** å®ç°å­ç±»ï¼Œæ— éœ€æ”¹æ ¸å¿ƒæºç ã€‚

### æ•°æ®æµä¸é˜Ÿåˆ—

- **ChannelManager** ä¸ºæ¯ä¸ªå¯ç”¨é˜Ÿåˆ—çš„ channel ç»´æŠ¤ä¸€ä¸ªé˜Ÿåˆ—ï¼›æ”¶åˆ°æ¶ˆæ¯æ—¶ channel è°ƒç”¨ **`self._enqueue(payload)`**ï¼ˆç”± manager å¯åŠ¨æ—¶æ³¨å…¥ï¼‰ï¼Œmanager åœ¨æ¶ˆè´¹å¾ªç¯ä¸­å†è°ƒç”¨ **`channel.consume_one(payload)`**ã€‚
- åŸºç±»å·²å®ç° **é»˜è®¤ `consume_one`**ï¼šæŠŠ payload è½¬æˆ `AgentRequest`ã€è·‘ `_process`ã€å¯¹æ¯æ¡å®Œæˆæ¶ˆæ¯è°ƒç”¨ `send_message_content`ã€é”™è¯¯æ—¶è°ƒç”¨ `_on_consume_error`ã€‚å¤šæ•°æ¸ é“åªéœ€å®ç°ã€Œå…¥å£â†’è¯·æ±‚ã€å’Œã€Œå›å¤â†’å‡ºå£ã€ï¼Œä¸å¿…é‡å†™ `consume_one`ã€‚

### å­ç±»å¿…é¡»å®ç°

| æ–¹æ³•                                                    | è¯´æ˜                                                                                                                                       |
| ------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
| `build_agent_request_from_native(self, native_payload)` | å°†æ¸ é“åŸç”Ÿæ¶ˆæ¯è½¬ä¸º `AgentRequest`ï¼ˆä½¿ç”¨ runtime çš„ `Message`/`TextContent`/`ImageContent` ç­‰ï¼‰ï¼Œå¹¶è®¾ç½® `request.channel_meta` ä¾›å‘é€ä½¿ç”¨ã€‚ |
| `from_env` / `from_config`                              | ä»ç¯å¢ƒå˜é‡æˆ–é…ç½®æ„å»ºå®ä¾‹ã€‚                                                                                                                 |
| `async start()` / `async stop()`                        | ç”Ÿå‘½å‘¨æœŸï¼ˆå»ºè¿ã€è®¢é˜…ã€æ¸…ç†ç­‰ï¼‰ã€‚                                                                                                           |
| `async send(self, to_handle, text, meta=None)`          | å‘é€ä¸€æ¡æ–‡æœ¬ï¼ˆåŠå¯é€‰é™„ä»¶ï¼‰ã€‚                                                                                                               |

### åŸºç±»æä¾›çš„é€šç”¨èƒ½åŠ›

- **æ¶ˆè´¹æµç¨‹**ï¼š`_payload_to_request`ï¼ˆpayloadâ†’AgentRequestï¼‰ã€`get_to_handle_from_request`ï¼ˆè§£æå‘é€ç›®æ ‡ï¼Œé»˜è®¤ `user_id`ï¼‰ã€`get_on_reply_sent_args`ï¼ˆå›è°ƒå‚æ•°ï¼‰ã€`_before_consume_process`ï¼ˆå¤„ç†å‰é’©å­ï¼Œå¦‚ä¿å­˜ receive_idï¼‰ã€`_on_consume_error`ï¼ˆé”™è¯¯æ—¶å‘é€ï¼Œé»˜è®¤ `send_content_parts`ï¼‰ã€å¯é€‰ **`refresh_webhook_or_token`**ï¼ˆç©ºå®ç°ï¼Œå­ç±»éœ€åˆ·æ–° token æ—¶è¦†ç›–ï¼‰ã€‚
- **è¾…åŠ©**ï¼š`resolve_session_id`ã€`build_agent_request_from_user_content`ã€`_message_to_content_parts`ã€`send_message_content`ã€`send_content_parts`ã€`to_handle_from_target`ã€‚

éœ€è¦ä¸åŒæ¶ˆè´¹é€»è¾‘æ—¶ï¼ˆå¦‚æ§åˆ¶å°æ‰“å°ã€é’‰é’‰åˆå¹¶å»æŠ–ï¼‰å†è¦†ç›– **`consume_one`**ï¼›éœ€è¦ä¸åŒå‘é€ç›®æ ‡æˆ–å›è°ƒå‚æ•°æ—¶è¦†ç›– **`get_to_handle_from_request`** / **`get_on_reply_sent_args`**ã€‚

### ç¤ºä¾‹ï¼šæœ€ç®€æ¸ é“ï¼ˆä»…æ–‡æœ¬ï¼‰

åªå¤„ç†æ–‡æœ¬ã€ä½¿ç”¨ manager é˜Ÿåˆ—æ—¶ï¼Œä¸å¿…å®ç° `consume_one`ï¼ŒåŸºç±»é»˜è®¤å³å¯ï¼š

```python
# my_channel.py
from agentscope_runtime.engine.schemas.agent_schemas import TextContent, ContentType
from copaw.app.channels.base import BaseChannel
from copaw.app.channels.schema import ChannelType

class MyChannel(BaseChannel):
    channel: ChannelType = "my_channel"

    def __init__(self, process, enabled=True, bot_prefix="", **kwargs):
        super().__init__(process, on_reply_sent=kwargs.get("on_reply_sent"))
        self.enabled = enabled
        self.bot_prefix = bot_prefix

    @classmethod
    def from_config(cls, process, config, on_reply_sent=None, show_tool_details=True):
        return cls(process=process, enabled=getattr(config, "enabled", True),
                   bot_prefix=getattr(config, "bot_prefix", ""), on_reply_sent=on_reply_sent)

    @classmethod
    def from_env(cls, process, on_reply_sent=None):
        return cls(process=process, on_reply_sent=on_reply_sent)

    def build_agent_request_from_native(self, native_payload):
        payload = native_payload if isinstance(native_payload, dict) else {}
        channel_id = payload.get("channel_id") or self.channel
        sender_id = payload.get("sender_id") or ""
        meta = payload.get("meta") or {}
        session_id = self.resolve_session_id(sender_id, meta)
        text = payload.get("text", "")
        content_parts = [TextContent(type=ContentType.TEXT, text=text)]
        request = self.build_agent_request_from_user_content(
            channel_id=channel_id, sender_id=sender_id, session_id=session_id,
            content_parts=content_parts, channel_meta=meta,
        )
        request.channel_meta = meta
        return request

    async def start(self):
        pass

    async def stop(self):
        pass

    async def send(self, to_handle, text, meta=None):
        # è°ƒç”¨ä½ çš„ HTTP API ç­‰å‘é€
        pass
```

æ”¶åˆ°æ¶ˆæ¯æ—¶ç»„ä¸€ä¸ª native å­—å…¸å¹¶å…¥é˜Ÿï¼ˆ`_enqueue` ç”± manager æ³¨å…¥ï¼‰ï¼š

```python
native = {
    "channel_id": "my_channel",
    "sender_id": "user_123",
    "text": "ä½ å¥½",
    "meta": {},
}
self._enqueue(native)
```

### ç¤ºä¾‹ï¼šå¤šæ¨¡æ€ï¼ˆæ–‡æœ¬ + å›¾ç‰‡/è§†é¢‘/éŸ³é¢‘/æ–‡ä»¶ï¼‰

åœ¨ `build_agent_request_from_native` é‡ŒæŠŠé™„ä»¶è§£ææˆ runtime çš„ contentï¼Œå†è°ƒç”¨ `build_agent_request_from_user_content`ï¼š

```python
from agentscope_runtime.engine.schemas.agent_schemas import (
    TextContent, ImageContent, VideoContent, AudioContent, FileContent, ContentType,
)

def build_agent_request_from_native(self, native_payload):
    payload = native_payload if isinstance(native_payload, dict) else {}
    channel_id = payload.get("channel_id") or self.channel
    sender_id = payload.get("sender_id") or ""
    meta = payload.get("meta") or {}
    session_id = self.resolve_session_id(sender_id, meta)
    content_parts = []
    if payload.get("text"):
        content_parts.append(TextContent(type=ContentType.TEXT, text=payload["text"]))
    for att in payload.get("attachments") or []:
        t = (att.get("type") or "file").lower()
        url = att.get("url") or ""
        if not url:
            continue
        if t == "image":
            content_parts.append(ImageContent(type=ContentType.IMAGE, image_url=url))
        elif t == "video":
            content_parts.append(VideoContent(type=ContentType.VIDEO, video_url=url))
        elif t == "audio":
            content_parts.append(AudioContent(type=ContentType.AUDIO, data=url))
        else:
            content_parts.append(FileContent(type=ContentType.FILE, file_url=url))
    if not content_parts:
        content_parts = [TextContent(type=ContentType.TEXT, text="")]
    request = self.build_agent_request_from_user_content(
        channel_id=channel_id, sender_id=sender_id, session_id=session_id,
        content_parts=content_parts, channel_meta=meta,
    )
    request.channel_meta = meta
    return request
```

### è‡ªå®šä¹‰æ¸ é“ç›®å½•ä¸ CLI

- **ç›®å½•**ï¼šå·¥ä½œç›®å½•ä¸‹çš„ `custom_channels/`ï¼ˆé»˜è®¤ `~/.copaw/custom_channels/`ï¼‰ç”¨äºå­˜æ”¾è‡ªå®šä¹‰æ¸ é“æ¨¡å—ã€‚Manager å¯åŠ¨æ—¶ä¼šæ‰«æè¯¥ç›®å½•ä¸‹çš„ `.py` æ–‡ä»¶ä¸åŒ…ï¼ˆå« `__init__.py` çš„å­ç›®å½•ï¼‰ï¼ŒåŠ è½½å…¶ä¸­çš„ `BaseChannel` å­ç±»ï¼Œå¹¶æŒ‰ç±»çš„ `channel` å±æ€§æ³¨å†Œã€‚
- **å®‰è£…**ï¼š`copaw channels install <key>` ä¼šåœ¨ `custom_channels/` ä¸‹ç”Ÿæˆåä¸º `<key>.py` çš„æ¨¡æ¿æ–‡ä»¶ï¼Œå¯ç›´æ¥ç¼–è¾‘å®ç°ï¼›ä¹Ÿå¯ç”¨ `--path <æœ¬åœ°è·¯å¾„>` æˆ– `--url <URL>` ä»æœ¬åœ°/ç½‘ç»œå¤åˆ¶æ¸ é“æ¨¡å—ã€‚`copaw channels add <key>` ç­‰ä»·äºå®‰è£…åå¹¶å†™å…¥ config é»˜è®¤é¡¹ï¼Œä¸”å¯åŠ  `--path`/`--url`ã€‚
- **åˆ é™¤**ï¼š`copaw channels remove <key>` ä¼šä» `custom_channels/` ä¸­åˆ é™¤è¯¥æ¸ é“æ¨¡å—ï¼ˆä»…æ”¯æŒè‡ªå®šä¹‰æ¸ é“ï¼Œå†…ç½®æ¸ é“ä¸å¯åˆ ï¼‰ï¼›åŠ  `--no-keep-config`ï¼ˆé»˜è®¤ï¼‰ä¼šåŒæ—¶ä» `config.json` çš„ `channels` ä¸­ç§»é™¤å¯¹åº” keyã€‚
- **Config**ï¼š`ChannelConfig` ä½¿ç”¨ `extra="allow"`ï¼Œ`config.json` çš„ `channels` ä¸‹å¯å†™ä»»æ„ keyï¼›è‡ªå®šä¹‰æ¸ é“çš„é…ç½®ä¼šä¿å­˜åœ¨ extra ä¸­ã€‚é…ç½®æ–¹å¼ä¸å†…ç½®ä¸€è‡´ï¼š`copaw channels config` äº¤äº’å¼é…ç½®ï¼Œæˆ–ç›´æ¥ç¼–è¾‘ configã€‚

---

## ç›¸å…³é¡µé¢

- [é¡¹ç›®ä»‹ç»](./intro) â€” è¿™ä¸ªé¡¹ç›®å¯ä»¥åšä»€ä¹ˆ
- [å¿«é€Ÿå¼€å§‹](./quickstart) â€” å®‰è£…ä¸é¦–æ¬¡å¯åŠ¨
- [å¿ƒè·³](./heartbeat) â€” å®šæ—¶è‡ªæ£€/æ‘˜è¦
- [CLI](./cli) â€” initã€appã€cronã€clean
- [é…ç½®ä¸å·¥ä½œç›®å½•](./config) â€” config.json ä¸å·¥ä½œç›®å½•

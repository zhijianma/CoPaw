[supervisord]
user=root
logfile=/var/log/supervisord.log
pidfile=/var/log/supervisord.pid
nodaemon=true

[program:dbus]
command=/bin/sh -c "rm -f /run/dbus/pid; mkdir -p /run/dbus; exec /usr/bin/dbus-daemon --system --nofork"
autostart=true
autorestart=true
stderr_logfile=/var/log/dbus.err.log
stdout_logfile=/var/log/dbus.out.log

[program:app]
command=copaw app --host 0.0.0.0 --port ${COPAW_PORT}
autostart=true
autorestart=true
priority=30
stderr_logfile=/var/log/app.err.log
stdout_logfile=/var/log/app.out.log
environment=DISPLAY=":1"

[program:xvfb]
command=/bin/sh -c "rm -f /tmp/.X1-lock /tmp/.X11-unix/X1; mkdir -p /tmp/.X11-unix; exec /usr/bin/Xvfb :1 -screen 0 1280x800x24"
autostart=true
autorestart=true
priority=10
stderr_logfile=/var/log/xvfb.err.log
stdout_logfile=/var/log/xvfb.out.log
environment=DISPLAY=":1"

[program:xfce4]
command=/bin/sh -c 'export DISPLAY=:1; for i in $(seq 1 200); do [ -S /tmp/.X11-unix/X1 ] && break; sleep 0.1; done; exec dbus-run-session startxfce4'
autostart=true
autorestart=true
priority=20
stderr_logfile=/var/log/xfce4.err.log
stdout_logfile=/var/log/xfce4.out.log
environment=DISPLAY=":1"

[program:ollama]
command=/usr/local/bin/ollama serve
autostart=true
autorestart=true
priority=5
stderr_logfile=/var/log/ollama.err.log
stdout_logfile=/var/log/ollama.out.log

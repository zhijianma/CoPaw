---
name: dingtalk_channel_connect
description: "ä½¿ç”¨å¯è§†æµè§ˆå™¨è‡ªåŠ¨å®Œæˆ CoPaw çš„é’‰é’‰é¢‘é“æ¥å…¥ã€‚é€‚ç”¨äºç”¨æˆ·æåˆ°é’‰é’‰ã€DingTalkã€å¼€å‘è€…åå°ã€Client IDã€Client Secretã€æœºå™¨äººã€Stream æ¨¡å¼ã€ç»‘å®šæˆ–é…ç½® channel çš„åœºæ™¯ï¼›æ”¯æŒé‡åˆ°ç™»å½•é¡µæ—¶æš‚åœï¼Œç­‰å¾…ç”¨æˆ·ç™»å½•åç»§ç»­ã€‚"
metadata:
  {
    "copaw":
      {
        "emoji": "ğŸ¤–",
        "requires": {}
      }
  }
---

# é’‰é’‰ Channel è‡ªåŠ¨è¿æ¥ï¼ˆå¯è§†æµè§ˆå™¨ï¼‰

æ­¤ skill ç”¨äºé€šè¿‡å¯è§†æµè§ˆå™¨è‡ªåŠ¨åŒ–å®Œæˆé’‰é’‰åº”ç”¨åˆ›å»ºä¸ CoPaw channel ç»‘å®šã€‚

## å¼ºåˆ¶è§„åˆ™

1. å¿…é¡»ä½¿ç”¨å¯è§†æµè§ˆå™¨æ¨¡å¼å¯åŠ¨ï¼š

```json
{"action": "start", "headed": true}
```

2. é‡åˆ°ç™»å½•å…³å¡å¿…é¡»æš‚åœï¼š
   - è‹¥é¡µé¢å‡ºç°ç™»å½•ç•Œé¢ï¼ˆå¦‚ `ç™»å½•`ã€æ‰«ç ç™»å½•ã€æ‰‹æœºå·/å¯†ç ç™»å½•ï¼‰ï¼Œç«‹å³åœæ­¢è‡ªåŠ¨æ“ä½œã€‚
   - æ˜ç¡®æç¤ºç”¨æˆ·å…ˆæ‰‹åŠ¨ç™»å½•ï¼Œå†ç­‰å¾…ç”¨æˆ·å›å¤â€œç™»å½•å¥½äº†/ç»§ç»­â€ã€‚
   - æœªæ”¶åˆ°ç”¨æˆ·ç¡®è®¤å‰ï¼Œä¸å¾—ç»§ç»­æ‰§è¡Œåç»­æ­¥éª¤ã€‚

3. ä»»ä½•åº”ç”¨é…ç½®å˜æ›´éƒ½å¿…é¡»æ–°å»ºç‰ˆæœ¬å¹¶å‘å¸ƒåæ‰ç”Ÿæ•ˆï¼š
   - é…ç½®å®Œæœºå™¨äººç›¸å…³ä¿¡æ¯å**ä¸€å®šè¦å‘å¸ƒæœºå™¨äºº**
   - ä¸è®ºæ˜¯æ–°å»ºåº”ç”¨è¿˜æ˜¯ä¿®æ”¹åº”ç”¨ä¿¡æ¯ï¼ˆåç§°ã€æè¿°ã€å›¾æ ‡ã€æœºå™¨äººé…ç½®ç­‰ï¼‰ï¼Œæœ€ç»ˆéƒ½**å¿…é¡»æ‰§è¡Œâ€œåˆ›å»ºæ–°ç‰ˆæœ¬ + å‘å¸ƒâ€**ã€‚
   - è‹¥æœªå®Œæˆå‘å¸ƒï¼Œä¸å¾—å®£ç§°é…ç½®å·²ç”Ÿæ•ˆã€‚

## æ‰§è¡Œå‰æ˜¾è‘—ç¡®è®¤ï¼ˆå¿…é¡»å…ˆåšï¼‰

åœ¨å¼€å§‹è‡ªåŠ¨åŒ–ç‚¹å‡»å‰ï¼Œå…ˆå‘ç”¨æˆ·å‘èµ·ä¸€æ¬¡â€œé…ç½®ç¡®è®¤â€ï¼Œæ˜ç¡®å‘ŠçŸ¥å¯è‡ªå®šä¹‰é¡¹ã€å›¾ç‰‡è§„èŒƒã€é»˜è®¤å€¼ã€‚å»ºè®®ä½¿ç”¨å¦‚ä¸‹ç»“æ„åŒ–ç¡®è®¤ï¼š

1. è®©ç”¨æˆ·å¯è‡ªå®šä¹‰ä»¥ä¸‹å­—æ®µï¼š
   - åº”ç”¨åç§°
   - åº”ç”¨æè¿°
   - æœºå™¨äººå›¾æ ‡å›¾ç‰‡é“¾æ¥æˆ–æœ¬åœ°è·¯å¾„
   - æœºå™¨äººæ¶ˆæ¯é¢„è§ˆå›¾é“¾æ¥æˆ–æœ¬åœ°è·¯å¾„

2. æ˜ç¡®å‘ŠçŸ¥å›¾ç‰‡è§„èŒƒï¼ˆæ˜¾è‘—æç¤ºï¼‰ï¼š
   - æœºå™¨äººå›¾æ ‡ï¼šä»…æ”¯æŒ JPG/PNGï¼Œ`240*240px` ä»¥ä¸Šï¼Œ`1:1`ï¼Œ`2MB` ä»¥å†…ï¼Œæ— åœ†è§’ã€‚
   - æœºå™¨äººæ¶ˆæ¯é¢„è§ˆå›¾ï¼šæ ¼å¼ `png/jpeg/jpg`ï¼Œä¸è¶…è¿‡ `2MB`ã€‚

3. æ˜ç¡®å‘ŠçŸ¥é»˜è®¤å€¼ï¼ˆç”¨æˆ·ä¸æŒ‡å®šæ—¶è‡ªåŠ¨é‡‡ç”¨ï¼‰ï¼š
   - åº”ç”¨åç§°ï¼š`CoPaw`
   - åº”ç”¨æè¿°ï¼š`Your personal assistant`
   - æœºå™¨äººå›¾æ ‡ï¼š`https://img.alicdn.com/imgextra/i4/O1CN01M0iyHF1FVNzM9qjC0_!!6000000000492-2-tps-254-254.png`
   - æœºå™¨äººæ¶ˆæ¯é¢„è§ˆå›¾ï¼š`https://img.alicdn.com/imgextra/i4/O1CN01M0iyHF1FVNzM9qjC0_!!6000000000492-2-tps-254-254.png`

4. è‹¥ç”¨æˆ·æœªç»™ä»»ä½•è‡ªå®šä¹‰å€¼ï¼Œå¿…é¡»å…ˆæ˜ç¡®å›å¤ï¼š
   - â€œå°†å…¨éƒ¨é‡‡ç”¨é»˜è®¤è®¾ç½®ï¼ˆCoPaw / Your personal assistant / é»˜è®¤å›¾ç‰‡ï¼‰åç»§ç»­æ‰§è¡Œã€‚â€

## å›¾ç‰‡ä¸Šä¼ ç­–ç•¥ï¼ˆlink/path éƒ½æ”¯æŒï¼‰

1. è‹¥ç”¨æˆ·æä¾›æœ¬åœ°è·¯å¾„ï¼Œç›´æ¥ç”¨äºä¸Šä¼ ã€‚
2. è‹¥ç”¨æˆ·æä¾›å›¾ç‰‡ linkï¼Œå…ˆä¸‹è½½åˆ°æœ¬åœ°ä¸´æ—¶æ–‡ä»¶ï¼Œå†æ‰§è¡Œä¸Šä¼ ã€‚
3. ä¸Šä¼ åŠ¨ä½œé¡ºåºå¿…é¡»æ˜¯ï¼š
   - å…ˆç‚¹å‡»é¡µé¢ä¸Šä¼ å…¥å£ï¼ˆè§¦å‘ chooserï¼‰
   - å†è°ƒç”¨ `file_upload` ä¼ å…¥æœ¬åœ°è·¯å¾„æ•°ç»„ï¼ˆ`paths_json`ï¼‰
4. è‹¥ä¸Šä¼ æŠ¥é”™ä¸”åˆ¤æ–­ä¸ºå›¾ç‰‡è§„æ ¼ä¸ç¬¦åˆï¼ˆå°ºå¯¸ã€æ¯”ä¾‹ã€å¤§å°ã€æ ¼å¼ï¼‰ï¼š
   - ç«‹å³æš‚åœè‡ªåŠ¨åŒ–
   - æ˜ç¡®è®©ç”¨æˆ·æ‰‹åŠ¨ä¸Šä¼ ç¬¦åˆè§„èŒƒçš„å›¾ç‰‡
   - ç”¨æˆ·ç¡®è®¤â€œå·²ä¸Šä¼ /ç»§ç»­â€åï¼Œä»å½“å‰æ­¥éª¤ç»§ç»­åç»­æµç¨‹

### ä¸Šä¼ åŠ¨ä½œå®æˆ˜ç»éªŒ

1. `file_upload` çš„ `paths_json` å¿…é¡»æ˜¯â€œJSON å­—ç¬¦ä¸²æ•°ç»„â€ï¼Œæ³¨æ„è½¬ä¹‰ï¼š

```json
{
  "action": "file_upload",
  "paths_json": "[\"xxx.png\"]",
  "frame_selector": "iframe[src*=\"/fe/app?isHideOuterFrame=true\"]"
}
```

2. è‹¥é¡µé¢åœ¨ iframe å†…ï¼Œå»ºè®®ä¼˜å…ˆå¸¦ä¸Š `frame_selector`ï¼Œå¦åˆ™å¯èƒ½å‡ºç°æ‰¾ä¸åˆ°ä¸Šä¼ æ§ä»¶æˆ– chooser æœªè§¦å‘ã€‚

3. ä¸Šä¼ å‰å¿…é¡»å…ˆç‚¹å‡»ä¸Šä¼ å…¥å£ï¼›è‹¥ç›´æ¥ `file_upload` ä¼šæŠ¥ï¼š
   - `No chooser. Click upload then file_upload.`

4. æœºå™¨äººå›¾æ ‡åŒºåŸŸçš„å¸¸è§ç»“æ„ç‰¹å¾å¯ç”¨äºå®šä½ï¼ˆç¤ºä¾‹ï¼‰ï¼š
   - `text: "* æœºå™¨äººå›¾æ ‡"`
   - `button: "ä½¿ç”¨åº”ç”¨å›¾æ ‡"`
   - `button: "avatar"`ï¼ˆé€šå¸¸å†…éƒ¨æœ‰ `img "avatar"`ï¼‰

5. å½“ snapshot ä¸­åŒæ—¶å‡ºç°â€œä½¿ç”¨åº”ç”¨å›¾æ ‡â€å’Œâ€œavatarâ€æ—¶ï¼Œä¼˜å…ˆç‚¹å‡» `avatar` æŒ‰é’®è§¦å‘ä¸Šä¼ ï¼Œå†æ‰§è¡Œ `file_upload`ã€‚

## è‡ªåŠ¨åŒ–æµç¨‹

### æ­¥éª¤ 1ï¼šæ‰“å¼€é’‰é’‰å¼€å‘è€…åå°

1. å¯è§†æ¨¡å¼å¯åŠ¨æµè§ˆå™¨ï¼ˆ`headed: true`ï¼‰
2. æ‰“å¼€ `https://open-dev.dingtalk.com/`
3. è°ƒç”¨ `snapshot` åˆ¤æ–­æ˜¯å¦éœ€è¦ç™»å½•

è‹¥éœ€è¦ç™»å½•ï¼Œä½¿ç”¨å¦‚ä¸‹è¯æœ¯æš‚åœï¼š

> æ£€æµ‹åˆ°éœ€è¦ç™»å½•é’‰é’‰å¼€å‘è€…åå°ã€‚æˆ‘å·²æš‚åœè‡ªåŠ¨æ“ä½œï¼Œè¯·å…ˆåœ¨å¼¹å‡ºçš„æµè§ˆå™¨ä¸­å®Œæˆç™»å½•ã€‚å®Œæˆåå›å¤â€œç»§ç»­â€ï¼Œæˆ‘å†ä»å½“å‰é¡µé¢æ¥ç€æ‰§è¡Œã€‚

### æ­¥éª¤ 2ï¼šåˆ›å»ºä¼ä¸šå†…éƒ¨åº”ç”¨

ç”¨æˆ·ç¡®è®¤ç™»å½•åç»§ç»­ï¼š

1. è¿›å…¥åˆ›å»ºè·¯å¾„ï¼š
   - åº”ç”¨å¼€å‘ -> ä¼ä¸šå†…éƒ¨åº”ç”¨ -> é’‰é’‰åº”ç”¨ -> åˆ›å»ºåº”ç”¨
2. å¡«å†™åº”ç”¨ä¿¡æ¯ï¼ˆä¼˜å…ˆä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤å€¼ï¼‰ï¼š
   - åº”ç”¨åç§°ï¼šé»˜è®¤ `CoPaw`
   - åº”ç”¨æè¿°ï¼šé»˜è®¤ `Your personal assistant`
3. ä¿å­˜å¹¶åˆ›å»ºåº”ç”¨

è‹¥é¡µé¢æ–‡æ¡ˆæˆ–ç»“æ„ä¸é¢„æœŸä¸ä¸€è‡´ï¼Œé‡æ–° `snapshot`ï¼ŒæŒ‰å¯è§æ–‡æœ¬è¯­ä¹‰é‡æ–°å®šä½å…ƒç´ ã€‚

### æ­¥éª¤ 3ï¼šæ·»åŠ æœºå™¨äººèƒ½åŠ›å¹¶å‘å¸ƒ

1. ç‚¹å‡»**åº”ç”¨èƒ½åŠ›**ä¸­çš„**æ·»åŠ åº”ç”¨èƒ½åŠ›**ï¼Œæ‰¾åˆ°**æœºå™¨äºº**å¹¶æ·»åŠ 
2. å°†**æœºå™¨äººé…ç½®**å³ä¾§çš„switchæŒ‰é’®åˆ‡æ¢ä¸ºæ‰“å¼€
3. å¡«å†™**æœºå™¨äººåç§°**ï¼Œ**æœºå™¨äººç®€ä»‹**å’Œ**æœºå™¨äººæè¿°**
4. ä¸Šä¼ **æœºå™¨äººå›¾æ ‡**ï¼ˆç”¨æˆ·è‡ªå®šä¹‰æˆ–é»˜è®¤å›¾ï¼‰ï¼š
   - ç‚¹å‡»æœºå™¨äººå›¾æ ‡ä¸‹é¢çš„å›¾ç‰‡
   - é»˜è®¤å›¾é“¾æ¥ï¼š`https://img.alicdn.com/imgextra/i4/O1CN01M0iyHF1FVNzM9qjC0_!!6000000000492-2-tps-254-254.png`
   - è‹¥ä¸º linkï¼Œå…ˆä¸‹è½½åˆ°æœ¬åœ°å†ä¸Šä¼ 
   - è‹¥æç¤ºå›¾ç‰‡ä¸åˆè§„ï¼Œæš‚åœå¹¶è®©ç”¨æˆ·æ‰‹åŠ¨ä¸Šä¼ åˆè§„å›¾ç‰‡åç»§ç»­
5. ä¸Šä¼ **æœºå™¨äººæ¶ˆæ¯é¢„è§ˆå›¾**ï¼ˆç”¨æˆ·è‡ªå®šä¹‰æˆ–é»˜è®¤å›¾ï¼‰ï¼š
   - ç‚¹å‡»æœºå™¨äººæ¶ˆæ¯é¢„è§ˆå›¾ä¸‹é¢çš„å›¾ç‰‡
   - é»˜è®¤å›¾é“¾æ¥ï¼š`https://img.alicdn.com/imgextra/i4/O1CN01M0iyHF1FVNzM9qjC0_!!6000000000492-2-tps-254-254.png`
   - è‹¥ä¸º linkï¼Œå…ˆä¸‹è½½åˆ°æœ¬åœ°å†ä¸Šä¼ 
   - è‹¥æç¤ºå›¾ç‰‡ä¸åˆè§„ï¼Œæš‚åœå¹¶è®©ç”¨æˆ·æ‰‹åŠ¨ä¸Šä¼ åˆè§„å›¾ç‰‡åç»§ç»­
6. ç¡®è®¤æ¶ˆæ¯æ¥æ”¶æ¨¡å¼è®¾ç½®ä¸º `Stream æ¨¡å¼`
7. é€‰æ‹©**å‘å¸ƒ**ï¼Œæ­¤æ—¶ä¼šæœ‰è¿›ä¸€æ­¥å¼¹å‡ºçš„ç¡®è®¤é¡µé¢ï¼Œé€‰æ‹©å‘å¸ƒã€‚æ³¨æ„ï¼š**ä¸€å®šè¦å‘å¸ƒæœºå™¨äºº**ä¹‹åå†è¿›è¡Œä¸‹ä¸€æ­¥

### æ­¥éª¤ 4ï¼šåˆ›å»ºç‰ˆæœ¬å¹¶å‘å¸ƒ

1. æ‰“å¼€ `åº”ç”¨å‘å¸ƒ -> ç‰ˆæœ¬ç®¡ç†ä¸å‘å¸ƒ`
2. åˆ›å»ºæ–°ç‰ˆæœ¬ï¼ˆæ¯æ¬¡é…ç½®å˜æ›´åéƒ½è¦åˆ›å»ºï¼‰
3. å¡«å†™ç‰ˆæœ¬æè¿°ï¼Œåº”ç”¨å¯è§èŒƒå›´é€‰æ‹©å…¨éƒ¨å‘˜å·¥
4. æŒ‰é¡µé¢æç¤ºå®Œæˆå‘å¸ƒï¼Œæ­¤æ—¶ä¼šæœ‰æ–°çš„å¼¹çª—å‡ºç°ï¼Œé€‰æ‹©ç¡®è®¤å‘å¸ƒ
5. åªæœ‰çœ‹åˆ°å‘å¸ƒæˆåŠŸçŠ¶æ€ï¼Œæ‰å¯ç»§ç»­æ‰§è¡Œåç»­æ­¥éª¤/ç»™ç”¨æˆ·â€œå·²ç”Ÿæ•ˆâ€ç»“è®º

### æ­¥éª¤ 5ï¼šè·å–å‡­è¯

1. æ‰“å¼€ `åŸºç¡€ä¿¡æ¯ -> å‡­è¯ä¸åŸºç¡€ä¿¡æ¯`
2. å‘ŠçŸ¥ç”¨æˆ·`Client ID`ï¼ˆAppKeyï¼‰å’Œ`Client Secret`ï¼ˆAppSecretï¼‰åœ¨è¯¥é¡µé¢ä¸Šã€‚ä¸ä¸»åŠ¨è¿›è¡Œä¿®æ”¹ï¼Œå¼•å¯¼ç”¨æˆ·è‡ªè¡Œç»‘å®š

## CoPaw ç»‘å®šæ–¹å¼

æ‹¿åˆ°å‡­è¯åï¼Œå¼•å¯¼ç”¨æˆ·é€‰æ‹©ä»¥ä¸‹ä»»ä¸€æ–¹å¼ï¼š

1. æ§åˆ¶å°å‰ç«¯é…ç½®ï¼š
   - CoPaw console ä¸­è¿›å…¥ `æ§åˆ¶ -> é¢‘é“ -> DingTalk`
   - å¡«å…¥ `Client ID` ä¸ `Client Secret`

2. é…ç½®æ–‡ä»¶æ–¹å¼ï¼š

```json
"dingtalk": {
  "enabled": true,
  "bot_prefix": "[BOT]",
  "client_id": "ä½ çš„ Client ID",
  "client_secret": "ä½ çš„ Client Secret"
}
```

è·¯å¾„ï¼š`~/.copaw/config.json`ï¼Œä½äº `channels.dingtalk` ä¸‹ã€‚

### å‡­è¯äº¤ä»˜è¦æ±‚ï¼ˆå¼ºåˆ¶ï¼‰

1. agent åªè´Ÿè´£å¼•å¯¼ç”¨æˆ·è¿›å…¥å‡­è¯é¡µã€è·å–å¹¶å±•ç¤º `Client ID` ä¸çœŸå® `Client Secret`ã€‚
2. agent ä¸ä¸»åŠ¨æ”¹ `console` é…ç½®ã€ä¸ä¸»åŠ¨æ”¹ `~/.copaw/config.json`ã€‚
3. å¿…é¡»æç¤ºç”¨æˆ·æŒ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ä¹‹ä¸€æ‰‹åŠ¨å¡«å†™ï¼š
   - æ§åˆ¶å°å‰ç«¯ï¼š`æ§åˆ¶ -> é¢‘é“ -> DingTalk`
   - é…ç½®æ–‡ä»¶ï¼šç¼–è¾‘ `~/.copaw/config.json` çš„ `channels.dingtalk` å­—æ®µ

## Browser å·¥å…·è°ƒç”¨æ¨¡å¼

é»˜è®¤æŒ‰ä»¥ä¸‹é¡ºåºæ‰§è¡Œï¼š

1. `start` with `headed: true`
2. `open`
3. `snapshot`
4. `click` / `type` / `select_option` / `press_key` as needed
5. frequent `snapshot` after page transitions
6. `stop` when done

## ç¨³å®šæ€§ä¸æ¢å¤ç­–ç•¥

- ä¼˜å…ˆä½¿ç”¨æœ€æ–° `snapshot` çš„ `ref`ï¼›ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨ `selector`ã€‚
- æ¯æ¬¡å…³é”®ç‚¹å‡»æˆ–è·³è½¬åï¼Œä½¿ç”¨çŸ­ç­‰å¾…ï¼ˆ`wait_for`ï¼‰å¹¶ç«‹å³é‡æ–° `snapshot`ã€‚
- è‹¥ä¸­é€”ä¼šè¯å¤±æ•ˆæˆ–è¦æ±‚é‡æ–°ç™»å½•ï¼Œå¿…é¡»å†æ¬¡æš‚åœï¼Œå¾…ç”¨æˆ·ç™»å½•åä»å½“å‰æ­¥éª¤ç»§ç»­ã€‚
- è‹¥å› ç§Ÿæˆ·æƒé™ã€ç®¡ç†å‘˜å®¡æ‰¹ç­‰é˜»å¡è‡ªåŠ¨åŒ–ï¼Œæ˜ç¡®è¯´æ˜å¡ç‚¹ï¼Œå¹¶è¯·ç”¨æˆ·æ‰‹åŠ¨å®Œæˆè¯¥æ­¥éª¤åå†ç»­è·‘ã€‚